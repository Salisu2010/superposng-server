:root{--bg:#0b1020;--card:#111a33;--muted:#9fb0ff;--text:#eef1ff;--btn:#3b82f6;}
*{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#0b1020,#0a0f1f);color:var(--text)}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:rgba(17,26,51,.9);border-bottom:1px solid rgba(255,255,255,.06)}
.brand{display:flex;gap:10px;align-items:center}
.logo{width:36px;height:36px;border-radius:10px;background:#0f1b3f;display:flex;align-items:center;justify-content:center;font-weight:800}
.wrap{max-width:980px;margin:0 auto;padding:26px}
.card{background:rgba(17,26,51,.85);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
label{display:block;font-size:12px;color:rgba(238,241,255,.75);margin-bottom:6px}
input,select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:#0f1732;color:var(--text)}
.btn{background:var(--btn);border:none;color:white;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
.btn:disabled{opacity:.6;cursor:not-allowed}
.row{display:flex;gap:10px;align-items:center}
.muted{color:rgba(238,241,255,.70);font-size:13px}
.err{color:#ffb4b4;margin-top:8px}
.hidden{display:none !important;}

/* Modal (Expiry List) */
.modalOverlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  z-index: 9999;
}
.modalCard{
  width: min(980px, 96vw);
  max-height: 86vh;
  overflow: auto;
  background: rgba(15,23,42,0.96);
  border: 1px solid rgba(148,163,184,0.25);
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.55);
}
.modalHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 14px 16px;
  border-bottom: 1px solid rgba(148,163,184,0.18);
}
.modalTitle{
  font-weight: 700;
  font-size: 18px;
}
.modalBody{ padding: 14px 16px 16px; }
.modalTools{ display:flex; gap:10px; align-items:center; margin-bottom:10px; flex-wrap:wrap; }
.modalTools .input{ flex: 1 1 420px; }
.tableWrap{ overflow:auto; border: 1px solid rgba(148,163,184,0.16); border-radius: 12px; }
.expiryTip{ opacity:0.9; font-size: 12px; margin-top: 10px; }
.shop{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0f1732;margin-top:8px}

.shopsList{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
.shopBtn{cursor:pointer;transition:transform .06s ease}
.shopBtn:hover{transform:translateY(-1px)}

.kpis{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;margin-top:12px}
.kpi{padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.08);background:#0f1732}
.kpi .v{font-size:18px;font-weight:800;margin-top:6px}

.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
.tab{background:#0f1732;border:1px solid rgba(255,255,255,.10);color:rgba(238,241,255,.90);padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:700}
.tab.active{background:var(--btn);border-color:rgba(255,255,255,.0);color:white}

.tableWrap{overflow:auto;margin-top:12px;border-radius:14px;border:1px solid rgba(255,255,255,.08)}
table{width:100%;border-collapse:collapse;background:#0f1732}
th,td{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.06);font-size:13px}
th{text-align:left;color:rgba(238,241,255,.75);font-weight:800;position:sticky;top:0;background:#0f1732}

@media(max-width:760px){
  .shopsList{grid-template-columns:1fr}
  .kpis{grid-template-columns:repeat(2,minmax(0,1fr))}
}
footer{opacity:.7;text-align:center;padding:20px 0}
@media(max-width:760px){.grid{grid-template-columns:1fr}}

/* ------------------------------
   Modal (Debtor Payments)
------------------------------ */
.modal-overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.55);
  display:flex;align-items:center;justify-content:center;
  padding:16px;
  z-index:9999;
}
.modal{
  width:min(520px,100%);
  background:rgba(20,24,36,.96);
  border:1px solid rgba(255,255,255,.12);
  border-radius:16px;
  box-shadow:0 12px 40px rgba(0,0,0,.35);
  overflow:hidden;
}
.modal-body{padding:16px}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:14px}
.modal h3{margin:0 0 8px 0;font-size:18px}
.modal p{margin:0 0 10px 0;opacity:.85}
.modal label{display:block;font-size:12px;opacity:.8;margin:8px 0 6px}
.modal input,.modal select{
  width:100%;padding:10px 12px;border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:inherit;
  outline:none;
}
.btn-sm{padding:6px 10px;border-radius:10px;font-size:12px}
.btn-ghost{
  background:transparent;
  border:1px solid rgba(255,255,255,.18);
}


/* World-class dashboard upgrades */
.dashGrid{
  display:grid;
  grid-template-columns: 1.4fr 1fr;
  gap:12px;
}
@media(max-width: 980px){
  .dashGrid{ grid-template-columns: 1fr; }
}
.cardInner{
  background: rgba(255,255,255,0.03);
  border:1px solid rgba(148,163,184,0.18);
  border-radius: 14px;
  padding: 14px;
}
.muted.tiny{ font-size: 12px; opacity: 0.85; }

.chip{
  border:1px solid rgba(148,163,184,0.25);
  background: rgba(255,255,255,0.03);
  color: #e2e8f0;
  padding: 6px 10px;
  border-radius: 999px;
  font-weight: 700;
  cursor:pointer;
}
.chip.active{
  background: rgba(56,189,248,0.16);
  border-color: rgba(56,189,248,0.5);
}

.insightsGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
}
@media(max-width: 980px){
  .insightsGrid{ grid-template-columns: 1fr; }
}
.miniList{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-top: 10px;
}
.miniItem{
  display:flex;
  justify-content:space-between;
  gap:10px;
  padding: 10px 10px;
  border-radius: 12px;
  border:1px solid rgba(148,163,184,0.16);
  background: rgba(2,6,23,0.25);
}
.miniItem b{ font-weight: 800; }
.badge{
  padding: 2px 8px;
  border-radius: 999px;
  border:1px solid rgba(148,163,184,0.22);
  background: rgba(255,255,255,0.03);
  font-size: 12px;
  font-weight: 800;
}
.badge.warn{
  background: rgba(245,158,11,0.14);
  border-color: rgba(245,158,11,0.35);
}
.badge.danger{
  background: rgba(239,68,68,0.14);
  border-color: rgba(239,68,68,0.35);
}


.alert{margin-top:10px;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(239,68,68,.12)}
.alert.warn{background:rgba(245,158,11,.12)}
.alert.hidden{display:none}
.settingsRow{margin-top:10px;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.10);background:rgba(59,130,246,.08)}
.input{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(17,26,51,.8);color:var(--text);outline:none}
.input:focus{border-color:rgba(59,130,246,.6)}


.modal.modal-lg{
  width:min(860px,100%);
}
.btn.warn{background:#f59e0b}
.btn.danger{background:#ef4444}
.pill{
  display:inline-flex;align-items:center;justify-content:center;
  padding:7px 10px;border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.12);
  font-size:12px;opacity:.95;
}



/* --- FIX: Expiry modal overlay + hidden class (override) --- */
.hidden{ display:none !important; }

.modal-overlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  padding: 16px;
}

.modal{
  width: min(980px, 96vw);
  max-height: min(80vh, 720px);
  overflow: hidden;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(10, 18, 40, 0.92);
  box-shadow: 0 20px 60px rgba(0,0,0,0.45);
}

.modal .modal-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding: 12px 14px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.modal .modal-body{
  padding: 12px 14px 16px;
  overflow:auto;
  max-height: calc(min(80vh, 720px) - 54px);
}

.modal .btn-close{
  cursor:pointer;
  border-radius: 999px;
  padding: 8px 14px;
}

.modal-overlay * { pointer-events: auto; }
/* --- END FIX --- */


/* --- Insights (no Chart.js) --- */
.trendBars{display:flex;flex-direction:column;gap:8px}
.trendRow{display:flex;align-items:center;gap:10px}
.trendDate{width:72px;font-size:12px;color:rgba(255,255,255,.75)}
.trendBarWrap{flex:1;height:10px;border-radius:999px;background:rgba(255,255,255,.10);overflow:hidden}
.trendBar{height:100%;border-radius:999px;background:rgba(59,130,246,.85)}
.trendVal{width:92px;text-align:right;font-size:12px;color:rgba(255,255,255,.85)}

.topProductsList{display:flex;flex-direction:column;gap:8px}
.tpRow{display:flex;align-items:center;gap:10px}
.tpName{flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:13px}
.tpMeta{font-size:12px;color:rgba(255,255,255,.75)}
.tpQty{width:60px;text-align:right;font-weight:700}

.profitCards{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.miniCard{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:10px}
.miniLabel{font-size:12px;color:rgba(255,255,255,.75)}
.miniValue{font-size:16px;font-weight:800;margin-top:4px}

.tableWrap{overflow:auto;border-radius:14px;border:1px solid rgba(255,255,255,.10)}
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:10px 10px;border-bottom:1px solid rgba(255,255,255,.08);font-size:13px}
.table thead th{position:sticky;top:0;background:rgba(17,26,51,.92);backdrop-filter:blur(6px);text-align:left}
.small{font-size:12px;opacity:.85}

/* Make modal overlay always hidden by default; JS controls display */
#expiryModalOverlay{display:none}
#expiryModalOverlay:not(.hidden){display:flex}

.hint{font-size:12px;opacity:.75;margin-top:6px;}
